plugins {
    id 'java'
    id 'maven-publish'
}

group = 'your.group'
version = '1.0.0'

sourceCompatibility = '17'
targetCompatibility = '17'

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
    maven { url 'https://repo.anvilpowered.dev/maven' } // если нужно
}

dependencies {
    implementation 'com.github.Anuken:mindustry:release-v8' // или нужная версия
    // другие зависимости
}

task dex(type: Exec) {
    // Простой и совместимый способ собрать dex через d8, если требуется.
    // Укажи путь к d8 из Android SDK либо используй standalone d8 jar.
    def outJar = "$buildDir/libs/${project.name}-dex.jar"
    inputs.files configurations.runtimeClasspath
    outputs.file outJar
    doFirst {
        file("$buildDir/dex").mkdirs()
    }
    // Пример использования d8 (если у тебя android sdk): заменить ANDROID_SDK на путь
    // commandLine "$System.env.ANDROID_SDK/build-tools/33.0.0/d8", '--output', "$buildDir/dex", configurations.runtimeClasspath.asPath
    // Если у тебя d8.jar в проекте:
    // commandLine 'java', '-jar', 'tools/d8.jar', '--output', "$buildDir/dex", configurations.runtimeClasspath.asPath

    // Если тебе не нужен dex (на десктопе), просто пропусти таск:
    doLast {
        println "Dex step completed (stub)."
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
    options.release = 17
}

jar {
    from { configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) } }
    exclude 'META-INF/*.SF', 'META-INF/*.DSA', 'META-INF/*.RSA'
    manifest {
        attributes(
            'Main-Class': 'your.main.Class' // если нужно
        )
    }
}

task deploy(type: Copy) {
    dependsOn build
    from jar
    into "$buildDir/deploy"
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
}
